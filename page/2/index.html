<!doctype html>



  


<html class="theme-next muse use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta property="og:type" content="website">
<meta property="og:title" content="Sloppy's Blog">
<meta property="og:url" content="http://nikoer.com/page/2/index.html">
<meta property="og:site_name" content="Sloppy's Blog">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Sloppy's Blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://nikoer.com/page/2/"/>





  <title> Sloppy's Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="">

  














  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Sloppy's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Startseite
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            Über
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archiv
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://nikoer.com/2016/12/02/蓝牙BLE模式下，IOS与Android系统的配对与通信/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Sloppy">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Sloppy's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Sloppy's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/02/蓝牙BLE模式下，IOS与Android系统的配对与通信/" itemprop="url">
                  蓝牙BLE模式下，IOS与Android系统的配对与通信
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-02T14:50:32+08:00">
                2016-12-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>前一文章里，研究了，Android,IOS各自的蓝牙实现方式，今天花了点时间研究蓝牙4.0，BLE协议下，Android与IOS两系统开发的APP实现用蓝牙的通信，</p>
<ul>
<li>IOS 6.0+</li>
<li>Android 5.0+</li>
</ul>
<p>我们这里把IOS做为外设，Android做为中央设备，IOS作为外设的代码，请参考上篇教程的源码，一模一样。这篇记录着重关系Android BLE的开发，下面是准备工作：</p>
<h4 id="添加AndroidManifest-xml中的权限"><a href="#添加AndroidManifest-xml中的权限" class="headerlink" title="添加AndroidManifest.xml中的权限"></a>添加AndroidManifest.xml中的权限</h4><p>记得要加uses-feature，参考源代码中的配置文件</p>
<h4 id="添加一个Service负责蓝牙的通信"><a href="#添加一个Service负责蓝牙的通信" class="headerlink" title="添加一个Service负责蓝牙的通信"></a>添加一个Service负责蓝牙的通信</h4><p>这里我就不给出代码了，请自行从参考网站中，下载，我只增加了一个写内容的方法</p>
<p><pre><br> public boolean writeValueData(BluetoothGattCharacteristic characteristic, byte[] data) {<br>    boolean ret = false;</pre></p>
<pre><code>if (data == null) {
    return false;
}
int length = data.length;
if (length &lt;= dataBufferSize) {
    characteristic.setValue(data);
    ret = mBluetoothGatt.writeCharacteristic(characteristic);
} else {
    int count = 0;
    int offset = 0;
    while (offset &lt; length) {

        if ((length - offset) &lt; dataBufferSize) {
            count = length - offset;
        } else {
            count = dataBufferSize;
        }
        byte tempArray[] = new byte[count];
        System.arraycopy(data, offset, tempArray, 0, count);

        characteristic.setValue(data);
        ret = mBluetoothGatt.writeCharacteristic(characteristic);

        if (!ret) {
            return ret;
        }

        offset = offset + count;
    }
}
return ret;
</code></pre><p>}<br></p>
<h3 id="修改直接相联蓝牙"><a href="#修改直接相联蓝牙" class="headerlink" title="修改直接相联蓝牙"></a>修改直接相联蓝牙</h3><p>教程中，各种数据，各种UI，我简化了。在拿到Service后直接相关，修改了其中的方法，代码如下：</p>
<p><pre><br> private void displayGattServices(List<bluetoothgattservice> gattServices) {<br>    if (gattServices == null) return;<br>    // Loops through available GATT Services.<br>    for (BluetoothGattService gattService : gattServices) {<br>        String uuid  = gattService.getUuid().toString();<br>        if(BluetoothLeService.UUID_HEART_RATE_MEASUREMENT.equals(gattService.getUuid())){<br>            Log.d(“gattService”, uuid);<br>            if(BluetoothGattCharacteristic.PROPERTY_READ&gt;0){<br>                List<bluetoothgattcharacteristic> gattCharacteristics =gattService.getCharacteristics();<br>                for (BluetoothGattCharacteristic gattCharacteristic : gattCharacteristics) {<br>                    String charUDID = gattCharacteristic.getUuid().toString();<br>                    if(charUDID.equalsIgnoreCase(SampleGattAttributes.CLIENT_CHARACTERISTIC_CONFIG)){<br>                        Log.d(“charUDID”, charUDID);<br>                        for(BluetoothGattDescriptor  descriptor:gattCharacteristic.getDescriptors()){<br>                            String desUDID = descriptor.getUuid().toString();<br>                            Log.d(“desUDID”, desUDID);<br>                        }<br>                        mCharacteristic = gattCharacteristic;<br>                        mBluetoothLeService.setCharacteristicNotification(gattCharacteristic, true);<br>                    }<br>                }<br>            }<br>        }<br>    }<br>}<br></bluetoothgattcharacteristic></bluetoothgattservice></pre><br>这里有个小问题。还没有弄明白，为什么，IOS跟Android的Descriptor的UDID不一样吗？我重新定义了下，相关的UDID，参考：SampleGattAttributes.</p>
<p>PS:在发送数据时，记得在IOS端输入Android端提示的Code，蓝牙连接密码</p>
<p>相关源码在：<a href="http://www.nikoer.com/data/HelloBlueTooth.zip" target="_blank" rel="external">代码查看下载</a></p>
<p>入口为： BLEActivity</p>
<p>参考：<a href="https://developer.android.com/guide/topics/connectivity/bluetooth-le.html" target="_blank" rel="external">https://developer.android.com/guide/topics/connectivity/bluetooth-le.html</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://nikoer.com/2016/12/01/蓝牙技术的初步探究/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Sloppy">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Sloppy's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Sloppy's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/01/蓝牙技术的初步探究/" itemprop="url">
                  蓝牙技术的初步探究
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-01T17:01:42+08:00">
                2016-12-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>前两天，BOSS问我Cocos2d-x适合开发APP吗。我说不太适合。当然跨平台的APP开发框架也有很多种，聊下来之后，发现UI的表现只是其次，主要是可能需要涉及到手机通过蓝牙技术，控制设备啊，之类的。象目前的车载设备，穿载设备(智能手环)，跟手机之间的通信，目前基本上都是在蓝牙通信基础之上（当然很多车载设备，智能设备也装有网卡，不过好象目前不是主流）。经过两天的研究，弄明白了一些概念，</p>
<h3 id="经典蓝牙"><a href="#经典蓝牙" class="headerlink" title="经典蓝牙"></a>经典蓝牙</h3><p>也就是蓝牙4.0之前,俗称经典蓝牙阶段</p>
<h3 id="蓝牙4-0"><a href="#蓝牙4-0" class="headerlink" title="蓝牙4.0"></a>蓝牙4.0</h3><p>这里面有一个重要的概念叫低功耗蓝牙(Bluetooth Low Energ),这种架构的芯片,有单模跟双模,双模即可以跟4.0阶段的蓝牙进行通信,也可以跟经典的蓝牙阶段进行通信.</p>
<blockquote>
<blockquote>
<p>在经典蓝牙阶段，IOS是拒绝不信任的设备接入的，这也就是，很多的Android设备的蓝牙不能跟IOS设备进行通信了。那Android跟IOS设备如果要通信怎么办，幸好，IOS6.0+支持BLE，Android5.0+也支持BLE的开发了，那两者如果要通信，每个系统的设备的应用，可以在这基础上进行开发通信了。</p>
</blockquote>
</blockquote>
<p>下面是这两天做的简单研究，代码部分，借鉴了网上很多朋友的，我在这里做一下规整与调试，并排除了代码中的一些错误：</p>
<p>IOS BLE协议下的代码例子：<a href="http://www.nikoer.com/data/IOSBlueTooth.zip" target="_blank" rel="external">代码查看下载</a></p>
<p>Android蓝牙经典阶段的代码例子：<a href="http://www.nikoer.com/data/HelloBlueTooth.zip" target="_blank" rel="external">代码查看下载</a></p>
<p>接下来，我花点时间研究下，Android BLE协议下的蓝牙开发，并实现与IOS的通信。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://nikoer.com/2016/11/23/NDK编译出现make-文件名过长-的解决方案/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Sloppy">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Sloppy's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Sloppy's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/23/NDK编译出现make-文件名过长-的解决方案/" itemprop="url">
                  NDK编译出现make(**文件名过长)的解决方案
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-11-23T10:09:00+08:00">
                2016-11-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>随着项目文件的变多，最近在Windows上编译Android版本的时候，会出现make(**206,文件名过长的问题)，google了一下，发现Windows的命令行的限制，以下是摘自Android开发网站的解释(<a href="https://developer.android.com/ndk/guides/android_mk.html" target="_blank" rel="external">https://developer.android.com/ndk/guides/android_mk.html</a>)</p>
<blockquote>
<p>This feature can be useful on Windows, where the command line accepts a maximum of only of 8191 characters, which can be too small for complex projects. It also impacts the compilation of individual source files, placing nearly all compiler flags inside list files, too.</p>
</blockquote>
<p>两种解决方案：</p>
<ul>
<li>一种是在Android.mk文件中，添加编译设置：LOCAL_SHORT_COMMANDS := true</li>
<li>二种是在Application.mk文件中：APP_SHORT_COMMANDS:=true</li>
</ul>
<p>第二种，可能会造成全部的编译慢一些</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://nikoer.com/2016/10/25/设备唯一标识及GUID的总结/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Sloppy">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Sloppy's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Sloppy's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/25/设备唯一标识及GUID的总结/" itemprop="url">
                  设备唯一标识及GUID的总结
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-10-25T16:17:58+08:00">
                2016-10-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="DeviceID"><a href="#DeviceID" class="headerlink" title="DeviceID"></a>DeviceID</h2><p>在很多应用中，经常需要用到。获取设备的唯一标识。而且是不能变化的，一旦用户删除APP，重新安装时，下次获取的跟上次获取的UDID是一样的，以前在苹果上，很容易实现，不过现在的IOS有各种限制。</p>
<h3 id="IOS解决方法："><a href="#IOS解决方法：" class="headerlink" title="IOS解决方法："></a>IOS解决方法：</h3><p><a href="https://github.com/ylechelle/OpenUDID" target="_blank" rel="external">OpenUDID</a></p>
<h3 id="Android解决方法："><a href="#Android解决方法：" class="headerlink" title="Android解决方法："></a>Android解决方法：</h3><p><a href="https://github.com/vieux/OpenUDID" target="_blank" rel="external">查看</a></p>
<h2 id="GUID"><a href="#GUID" class="headerlink" title="GUID"></a>GUID</h2><p>当然，还有好多应用，需要生成种唯一标识符，这里也提供一下参考：<a href="https://github.com/graeme-hill/crossguid" target="_blank" rel="external">crossguid</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://nikoer.com/2016/10/24/IOS自带的md5-sha1/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Sloppy">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Sloppy's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Sloppy's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/24/IOS自带的md5-sha1/" itemprop="url">
                  IOS自带的md5,sha1
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-10-24T16:40:57+08:00">
                2016-10-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>相信很多在做校验的相关功能中，会用到md5,跟sha1的相关字符串校验，IOS中自带此功能，具体代码如下：</p>
<pre>
#include "CommonCrypto/CommonDigest.h"// 双引号替换成<>
static inline char hexChar(unsigned char c) {
    return c < 10 ? '0' + c : 'a' + c - 10;
}

static inline void hexString(unsigned char *from, char *to, NSUInteger length) {
    for (NSUInteger i = 0; i < length; ++i) {
        unsigned char c = from[i];
        unsigned char cHigh = c >> 4;
        unsigned char cLow = c & 0xf;
        to[2 * i] = hexChar(cHigh);
        to[2 * i + 1] = hexChar(cLow);
    }
    to[2 * length] = '\0';
}

NSString * md5(const char *string) {
    static const NSUInteger LENGTH = 16;
    unsigned char result[LENGTH];
    CC_MD5(string, (CC_LONG)strlen(string), result);

    char hexResult[2 * LENGTH + 1];
    hexString(result, hexResult, LENGTH);

    return [NSString stringWithUTF8String:hexResult];
}

NSLog(@"%@", md5("test"));

NSString * sha1(const char *string) {
    static const NSUInteger LENGTH = 20;
    unsigned char result[LENGTH];
    CC_SHA1(string, (CC_LONG)strlen(string), result);

    char hexResult[2 * LENGTH + 1];
    hexString(result, hexResult, LENGTH);

    return [NSString stringWithUTF8String:hexResult];
}

NSLog(@"%@", sha1("test"));
</pre>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://nikoer.com/2016/10/18/IOS推送证书的不同语言的制作方法/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Sloppy">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Sloppy's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Sloppy's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/18/IOS推送证书的不同语言的制作方法/" itemprop="url">
                  IOS推送证书的不同语言的制作方法
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-10-18T09:40:00+08:00">
                2016-10-18
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h3><p>导出私钥：</p>
<p>developer下载aps_development.cer</p>
<p>钥匙串 -&gt; Keys -&gt; 右边的私钥</p>
<p>1, openssl x509 -in aps_development.cer -inform der -out ErayOFFRemotionNotification.pem  </p>
<p>2，openssl pkcs12 -nocerts -out ErayOFFRemotionNotificationKey.pem -in Certificates.p12</p>
<p>3，cat ErayOFFRemotionNotification.pem ErayOFFRemotionNotificationKey.pem  &gt; ErayOFFNotification.pem</p>
<h3 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h3><p>钥匙串 -&gt; My Certificates 导出对应的Push证书 P12</p>
<h3 id="NodeJS"><a href="#NodeJS" class="headerlink" title="NodeJS"></a>NodeJS</h3><p>钥匙串 -&gt; My Certificates 导出对应的Push证书 cer格式</p>
<p>钥匙串 -&gt; My Certificates 展开私钥 导出对应的Push证书 p12格式</p>
<p>1，openssl x509 -in cert.cer -inform DER -outform PEM -out cert.pem</p>
<p>2，openssl pkcs12 -in key.p12 -out key.pem -nodes</p>
<p>密码都输入：123456</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://nikoer.com/2016/10/17/NodeJS实现IOS中的APNS/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Sloppy">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Sloppy's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Sloppy's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/17/NodeJS实现IOS中的APNS/" itemprop="url">
                  NodeJS实现IOS中的APNS
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-10-17T13:48:55+08:00">
                2016-10-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="生成证书"><a href="#生成证书" class="headerlink" title="生成证书"></a>生成证书</h2><h3 id="导出"><a href="#导出" class="headerlink" title="导出"></a>导出</h3><p>打开钥匙串：<br>    钥匙串 -&gt; My Certificates 导出对应的Push证书 （cer格式）<br>    钥匙串 -&gt; My Certificates 展开私钥 导出对应的证书<br>密码输入：123456</p>
<h3 id="生成PEM"><a href="#生成PEM" class="headerlink" title="生成PEM"></a>生成PEM</h3><p>Push证书 p12格式<br>终端输入<br>1，openssl x509 -in cert.cer -inform DER -outform PEM -out cert.pem<br>2，openssl pkcs12 -in key.p12 -out key.pem -nodes</p>
<h2 id="NodeJS代码"><a href="#NodeJS代码" class="headerlink" title="NodeJS代码"></a>NodeJS代码</h2><h3 id="安装apn"><a href="#安装apn" class="headerlink" title="安装apn"></a>安装apn</h3><p>npm install apn</p>
<h3 id="编写代码："><a href="#编写代码：" class="headerlink" title="编写代码："></a>编写代码：</h3><p>IOS注册省略</p>
<pre>
var apn = require("apn");

var tokens = ["e73447af823400987c05f31a2b5a0960a729ceaea9d772869f0f22eb463bea8c"];

var service = new apn.Provider({
  "cert": "push/cert.pem",
  "key": "push/key.pem",
  "passphrase":"123456",
  "production":false
});

var note = new apn.Notification({
  "alert":"末世战纪欢迎您的到来",
  "sound":"default"
});

// The topic is usually the bundle identifier of your application.
note.topic = "com.eray.off";
note.badge = 1;

console.log(`Sending: ${note.compile()} to ${tokens}`);
service.send(note, tokens).then( result => {
    console.log("sent:", result.sent.length);
    console.log("failed:", result.failed.length);
    console.log(result.failed);
});

// For one-shot notification tasks you may wish to shutdown the connection
// after everything is sent, but only call shutdown if you need your 
// application to terminate.
service.shutdown();
</pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://nikoer.com/2016/10/17/std-sort元素相等导致crash/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Sloppy">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Sloppy's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Sloppy's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/17/std-sort元素相等导致crash/" itemprop="url">
                  std::sort元素相等导致crash
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-10-17T12:38:38+08:00">
                2016-10-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近项目里碰到一个奇怪的问题。在某些特定的服务器上，执行某段代码，会突然Crash，代码没有动过，查了半天。原来是std::sort搞出的问题，因为之前返回的元素从来没有相等的情况，所以没有出现过Crash,STD的sort,如果出现两个相等的元素返回true,会导致越界行为</p>
<pre>
std::vector<int> list = {2,1,1,3,};
std::sort(list.begin(), list.end(), [](int a,int b){
    if (a == b){// 这地方
        return true;
    }
    return a > b;
});
</int></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://nikoer.com/2016/10/12/NodeJS验证IOSIAP充值/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Sloppy">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Sloppy's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Sloppy's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/12/NodeJS验证IOSIAP充值/" itemprop="url">
                  NodeJS验证IOSIAP充值
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-10-12T16:16:10+08:00">
                2016-10-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>对于很多前端开发者来说，经常需要自己写一些测试验证程序，当然很多的前端开发者，都会PHP，Java，写个简单的服务器测试程序也很简单。但是苦于有的同学，没有这些经验，也没有这些环境，而NodeJS也是前端开发者必备的环境之一，同时也可以很好的开发服务器程序，当然现在很多成熟的游戏都是基于NodeJS的，前几开在做IOS的内购测试。需要在服务端连接苹果服务器进行验证。写了一个简单的测试程序，记下来。备以后查找</p>
<pre>
/**
* @brief 跟苹果服务充值服务器进行检验
* @param receiptData IOS充值回调的transaction.transactionReceipt base64Encoding
* @param responder 验证回调
* @param inReview 是否处于审核阶段
*/ 
var verifyReceipt = function(receiptData, responder,inReview){
  var receiptEnvelope = {"receipt-data": receiptData};
  var receiptEnvelopeStr = JSON.stringify(receiptEnvelope);
  var options = {
      host: inReview?'sandbox.itunes.apple.com':'buy.itunes.apple.com',
      port: 443,
      path: '/verifyReceipt',
      method: 'POST',
      headers: {
          'Content-Type': 'application/x-www-form-urlencoded',
          'Content-Length': Buffer.byteLength(receiptEnvelopeStr)
      }
  };

  var req = https.request(options, function(res) {
      var _data='';
      res.setEncoding('utf8');
      res.on('data', function (chunk) {
          _data += chunk;
      });
      res.on('end', function () {
          console.log("body: " + _data);
          responder(_data);
      });
  });

  req.write(receiptEnvelopeStr);
  req.end();
};
</pre>

<p>客户端服务端代码参考：<a href="http://www.nikoer.com/data/main.zip" target="_blank" rel="external">下载</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://nikoer.com/2016/09/22/AndroidJava调用C-，及C-调用Java/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Sloppy">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Sloppy's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Sloppy's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/22/AndroidJava调用C-，及C-调用Java/" itemprop="url">
                  AndroidJava调用C++，及C++调用Java
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-09-22T12:41:19+08:00">
                2016-09-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>正常的Android开发过程中，难免会出现需要大量的计算，这时候，我们可能就会想到，需要提高计算的速度，这里可能想到利用c/C++,来提高运算速度，那我们这时候，就需要接触到这方面的相关知识了，下面我们作一下简单的实例测试，需要用的工具，包括Android SDK，NDK</p>
<h2 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h2><p>首先我们创建一个简单的Android项目，然后在layout布局文件上，加一个简单的textview，取名ID为，labelTxt,设置字内容为HelloAndroid.在MainActivity里定义一个方法方法，同时添加载入SO文件的逻辑，内容如下 ：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">public native String  stringFromJNI();</div><div class="line">static&#123; </div><div class="line">	System.loadLibrary(&quot;jni-test&quot;); // 为什么叫jni-test,跟后面的MK文件内容配置</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在onCreate方法里添加如下内容：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">String str = &quot;Form Assets so:&quot;+stringFromJNI();</div><div class="line">TextView txt = (TextView)this.findViewById(R.id.labelTxt);</div><div class="line">if(txt!=null)&#123;</div><div class="line">	txt.setText(str);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="Java调用C"><a href="#Java调用C" class="headerlink" title="Java调用C++"></a>Java调用C++</h2><p>这里，我自己手动编写CPP(com_nikoer_helloandroidapp_MainActivity.cpp)文件内容如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">#include &lt;jni.h&gt;</div><div class="line">#include &lt;android/log.h&gt;</div><div class="line">#include &lt;string&gt;</div><div class="line">#include &quot;JniHelper.h&quot;</div><div class="line"></div><div class="line"></div><div class="line">#define  LOG_TAG    &quot;MAIN&quot;</div><div class="line">#define  LOGD(...)  __android_log_print(ANDROID_LOG_DEBUG,LOG_TAG,__VA_ARGS__)</div><div class="line">#define  LOGE(...)  __android_log_print(ANDROID_LOG_ERROR,LOG_TAG,__VA_ARGS__)</div><div class="line"></div><div class="line"></div><div class="line">extern &quot;C&quot;</div><div class="line">&#123;</div><div class="line"></div><div class="line">	JNIEXPORT jstring JNICALL Java_com_nikoer_helloandroidapp_MainActivity_stringFromJNI(JNIEnv* env, jobject thiz)&#123;</div><div class="line"></div><div class="line">		std::string t=&quot;JNI Value&quot;;</div><div class="line">		return env-&gt;NewStringUTF(t.c_str());</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	JNIEXPORT jint JNI_OnLoad(JavaVM *vm, void *reserved)</div><div class="line">	&#123;</div><div class="line">		LOGD(&quot;JNI_OnLoad&quot;);</div><div class="line">		return JNI_VERSION_1_4;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这里我用的的是C++编译，所以用到了extern “c”</p>
<p>在项目根目录下建一个jni目录，把CPP文件复制进去，在jni目录下编写Android.mk文件，跟Application.mk文件，<br>Android.mk:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">LOCAL_PATH := $(call my-dir)</div><div class="line"></div><div class="line">include $(CLEAR_VARS)</div><div class="line"></div><div class="line">LOCAL_LDLIBS := -landroid</div><div class="line">LOCAL_LDLIBS += -llog</div><div class="line"></div><div class="line">LOCAL_MODULE    := jni-test</div><div class="line">LOCAL_SRC_FILES := com_nikoer_helloandroidapp_MainActivity.cpp</div><div class="line"></div><div class="line">include $(BUILD_SHARED_LIBRARY)</div></pre></td></tr></table></figure></p>
<p>Application.mk:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">APP_STL := gnustl_static</div><div class="line"></div><div class="line">APP_CPPFLAGS := -frtti -DCC_ENABLE_CHIPMUNK_INTEGRATION=1 -std=c++11 -fsigned-char</div><div class="line">APP_LDFLAGS := -latomic</div><div class="line"></div><div class="line">APP_ABI := armeabi</div></pre></td></tr></table></figure></p>
<p>在jni目录下，运行命令行,输入:ndk-build   (当前前掉得设置ndk的环境变量，才可以运行ndk-build命令)，用eclipse刷新项目，运行目录。是不是发布HelloWorld变成了JNI Value.</p>
<h2 id="C-调用Java"><a href="#C-调用Java" class="headerlink" title="C++调用Java"></a>C++调用Java</h2><p>这里我们封闭一个类出来JniHelper,内容如下：<br>JniHelper.h<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">#pragma once</div><div class="line">#include &lt;jni.h&gt;</div><div class="line"></div><div class="line">typedef struct JniMethodInfo_</div><div class="line">&#123;</div><div class="line">    JNIEnv *    env;</div><div class="line">    jclass      classID;</div><div class="line">    jmethodID   methodID;</div><div class="line">&#125; JniMethodInfo;</div><div class="line">class JniHelper&#123;</div><div class="line">public:</div><div class="line">	static void setJavaVM(JavaVM *vm);</div><div class="line">	static JNIEnv* getEnv();</div><div class="line">	static bool getStaticMethodInfo(JniMethodInfo &amp;methodinfo, const char *className, const char *methodName,const char *paramCode);</div><div class="line">private:</div><div class="line">	static JavaVM *pvm;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>JniHelper.cpp<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line">#include &quot;JniHelper.h&quot;</div><div class="line">#include &lt;android/log.h&gt;</div><div class="line"></div><div class="line"></div><div class="line">#define  LOG_TAG    &quot;JniHelper&quot;</div><div class="line">#define  LOGD(...)  __android_log_print(ANDROID_LOG_DEBUG,LOG_TAG,__VA_ARGS__)</div><div class="line">#define  LOGE(...)  __android_log_print(ANDROID_LOG_ERROR,LOG_TAG,__VA_ARGS__)</div><div class="line"></div><div class="line">JavaVM* JniHelper::pvm=nullptr;</div><div class="line"></div><div class="line">void JniHelper::setJavaVM(JavaVM *vm)&#123;</div><div class="line">	pvm = vm;</div><div class="line">&#125;</div><div class="line"></div><div class="line">JNIEnv* JniHelper::getEnv()&#123;</div><div class="line">	JNIEnv*  env=nullptr;</div><div class="line">    pvm-&gt;GetEnv((void**)&amp;env,JNI_VERSION_1_4);</div><div class="line">    return env;</div><div class="line">&#125;</div><div class="line"></div><div class="line"> bool JniHelper::getStaticMethodInfo(JniMethodInfo &amp;methodinfo, const char *className,const char *methodName, const char *paramCode) &#123;</div><div class="line">    if ((nullptr == className) ||</div><div class="line">        (nullptr == methodName) ||</div><div class="line">        (nullptr == paramCode)) &#123;</div><div class="line">        return false;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    JNIEnv *env = JniHelper::getEnv();</div><div class="line">    if (!env) &#123;</div><div class="line">        LOGE(&quot;Failed to get JNIEnv&quot;);</div><div class="line">        return false;</div><div class="line">    &#125;</div><div class="line">        </div><div class="line">    jclass classID = env-&gt;FindClass(className);</div><div class="line">    if (! classID) &#123;</div><div class="line">        LOGE(&quot;Failed to find class %s&quot;, className);</div><div class="line">        env-&gt;ExceptionClear();</div><div class="line">        return false;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    jmethodID methodID = env-&gt;GetStaticMethodID(classID, methodName, paramCode);</div><div class="line">    if (! methodID) &#123;</div><div class="line">        LOGE(&quot;Failed to find static method id of %s&quot;, methodName);</div><div class="line">        env-&gt;ExceptionClear();</div><div class="line">        return false;</div><div class="line">    &#125;</div><div class="line">        </div><div class="line">    methodinfo.classID = classID;</div><div class="line">    methodinfo.env = env;</div><div class="line">    methodinfo.methodID = methodID;</div><div class="line">    return true;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>修改入口文件com_nikoer_helloandroidapp_MainActivity.cpp:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">extern &quot;C&quot;</div><div class="line">&#123;</div><div class="line"></div><div class="line">	JNIEXPORT jstring JNICALL Java_com_nikoer_helloandroidapp_MainActivity_stringFromJNI(JNIEnv* env, jobject thiz)&#123;</div><div class="line"></div><div class="line">		std::string t=&quot;JNI Value&quot;;</div><div class="line"></div><div class="line">		// 开始由C++ 调用Java</div><div class="line">		JniMethodInfo minfo;</div><div class="line">		bool result = JniHelper::getStaticMethodInfo(minfo,&quot;com/nikoer/helloandroidapp/MainActivity&quot;,&quot;getTime&quot;,&quot;()Ljava/lang/String;&quot;);</div><div class="line">		if(result)&#123;</div><div class="line">			jstring jstr = (jstring)minfo.env-&gt;CallStaticObjectMethod(minfo.classID, minfo.methodID);</div><div class="line">			t = &quot;JNI:&quot;+std::string((char*)env-&gt;GetStringUTFChars(jstr, 0));</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		return env-&gt;NewStringUTF(t.c_str());</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	JNIEXPORT jint JNI_OnLoad(JavaVM *vm, void *reserved)</div><div class="line">	&#123;</div><div class="line">		LOGD(&quot;JNI_OnLoad&quot;);</div><div class="line">		JniHelper::setJavaVM(vm);</div><div class="line">		return JNI_VERSION_1_4;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>修改Android.mk:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">LOCAL_PATH := $(call my-dir)</div><div class="line"></div><div class="line">include $(CLEAR_VARS)</div><div class="line"></div><div class="line">LOCAL_LDLIBS := -landroid</div><div class="line">LOCAL_LDLIBS += -llog</div><div class="line"></div><div class="line">LOCAL_MODULE    := jni-test</div><div class="line">LOCAL_SRC_FILES := com_nikoer_helloandroidapp_MainActivity.cpp \</div><div class="line">				   JniHelper.cpp</div><div class="line"></div><div class="line">include $(BUILD_SHARED_LIBRARY)</div></pre></td></tr></table></figure></p>
<p>修改JavaActivity,添加如下方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">public static String getTime() &#123;</div><div class="line">	return String.valueOf(System.currentTimeMillis());</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>运行:ndk-build,再用Eclipse刷新项目，运行项目，是不是变成时间字符串了</p>
<p>源文件参考：<a href="http://www.nikoer.com/data/jni.zip" target="_blank" rel="external">下载</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>


          
          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="Sloppy" />
          <p class="site-author-name" itemprop="name">Sloppy</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">49</span>
                <span class="site-state-item-name">Artikel</span>
              </a>
            </div>
          

          

          
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">7</span>
                <span class="site-state-item-name">Tags</span>
              
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Sloppy</span>
</div>


<div class="powered-by">
  Erstellt mit  <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    
    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  





  



  
  

  

  

  

  


  

</body>
</html>
